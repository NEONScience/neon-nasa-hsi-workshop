<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>AVIRIS Data - Discovery, Access, and Visualization – NEON AOP &amp; NASA AVIRIS Airborne and Field Data Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-bb05f5d0074da2129d766b238819cd35.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-cb4c65b174a86268c128f8f7175eb5ec.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-bb05f5d0074da2129d766b238819cd35.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#demo-earthdata-search---ornl-daac-airborne-facility-instrument-and-campaign-collections" id="toc-demo-earthdata-search---ornl-daac-airborne-facility-instrument-and-campaign-collections" class="nav-link" data-scroll-target="#demo-earthdata-search---ornl-daac-airborne-facility-instrument-and-campaign-collections">Demo: Earthdata Search - ORNL DAAC Airborne Facility Instrument and Campaign Collections</a></li>
  <li><a href="#tutorial-programmatic-discovery-and-access-of-airborne-data" id="toc-tutorial-programmatic-discovery-and-access-of-airborne-data" class="nav-link" data-scroll-target="#tutorial-programmatic-discovery-and-access-of-airborne-data">Tutorial: Programmatic Discovery and Access of Airborne Data</a>
  <ul class="collapse">
  <li><a href="#requirements" id="toc-requirements" class="nav-link" data-scroll-target="#requirements">Requirements</a></li>
  </ul></li>
  <li><a href="#step-1-authentication-and-airbone-datasets-search-examples-with-earthaccess" id="toc-step-1-authentication-and-airbone-datasets-search-examples-with-earthaccess" class="nav-link" data-scroll-target="#step-1-authentication-and-airbone-datasets-search-examples-with-earthaccess">Step 1: Authentication and Airbone Datasets Search Examples with earthaccess</a>
  <ul class="collapse">
  <li><a href="#earthaccess-to-search-the-nasa-common-metadata-repository-for-a-specific-airborne-instrument" id="toc-earthaccess-to-search-the-nasa-common-metadata-repository-for-a-specific-airborne-instrument" class="nav-link" data-scroll-target="#earthaccess-to-search-the-nasa-common-metadata-repository-for-a-specific-airborne-instrument">1.1 <code>earthaccess</code> to search the NASA Common Metadata Repository for a specific airborne <code>instrument</code></a></li>
  <li><a href="#search-umm-g-for-specific-campaigns" id="toc-search-umm-g-for-specific-campaigns" class="nav-link" data-scroll-target="#search-umm-g-for-specific-campaigns">1.2 Search UMM-G for Specific Campaigns</a></li>
  <li><a href="#search-by-project-knowing-our-dataset-of-interest-was-part-of-the-bioscape-project." id="toc-search-by-project-knowing-our-dataset-of-interest-was-part-of-the-bioscape-project." class="nav-link" data-scroll-target="#search-by-project-knowing-our-dataset-of-interest-was-part-of-the-bioscape-project.">1.3 Search by <strong><code>Project</code></strong> knowing our dataset of interest was part of the BioSCape project.</a></li>
  </ul></li>
  <li><a href="#step-2.-further-define-and-refine-our-search-parameters" id="toc-step-2.-further-define-and-refine-our-search-parameters" class="nav-link" data-scroll-target="#step-2.-further-define-and-refine-our-search-parameters">Step 2. Further Define and Refine our Search Parameters</a>
  <ul class="collapse">
  <li><a href="#define-more-search-parameters-to-limit-our-search" id="toc-define-more-search-parameters-to-limit-our-search" class="nav-link" data-scroll-target="#define-more-search-parameters-to-limit-our-search">2.1 Define more search parameters to limit our search</a></li>
  <li><a href="#create-and-visualize-the-bounding-boxes-of-the-subset-of-files" id="toc-create-and-visualize-the-bounding-boxes-of-the-subset-of-files" class="nav-link" data-scroll-target="#create-and-visualize-the-bounding-boxes-of-the-subset-of-files">2.2 Create and Visualize the <strong><code>Bounding Boxes</code></strong> of the subset of files</a></li>
  </ul></li>
  <li><a href="#step-3.-cloud-based-access-methods" id="toc-step-3.-cloud-based-access-methods" class="nav-link" data-scroll-target="#step-3.-cloud-based-access-methods">Step 3. Cloud-based Access Methods</a>
  <ul class="collapse">
  <li><a href="#directly-open-and-access-nasa-earthdata-from-the-aws-s3-session" id="toc-directly-open-and-access-nasa-earthdata-from-the-aws-s3-session" class="nav-link" data-scroll-target="#directly-open-and-access-nasa-earthdata-from-the-aws-s3-session">3.1 Directly Open and Access NASA Earthdata from the AWS S3 Session</a></li>
  <li><a href="#step-3.2-list-s3-links-for-mosaic-aviris-ng-425-band-reflectance-netcdf-files" id="toc-step-3.2-list-s3-links-for-mosaic-aviris-ng-425-band-reflectance-netcdf-files" class="nav-link" data-scroll-target="#step-3.2-list-s3-links-for-mosaic-aviris-ng-425-band-reflectance-netcdf-files">Step 3.2 List S3 Links for Mosaic AVIRIS-NG 425-band Reflectance netCDF Files</a></li>
  <li><a href="#step-3.3-directly-open-access-and-visualize-aviris-ng-mosaic-data-from-the-aws-s3-session" id="toc-step-3.3-directly-open-access-and-visualize-aviris-ng-mosaic-data-from-the-aws-s3-session" class="nav-link" data-scroll-target="#step-3.3-directly-open-access-and-visualize-aviris-ng-mosaic-data-from-the-aws-s3-session">Step 3.3 Directly Open, Access, and Visualize AVIRIS-NG Mosaic Data from the AWS S3 Session</a></li>
  <li><a href="#step-3.4-plot-terrestrial-and-aquatic-plots-spectral-profiles" id="toc-step-3.4-plot-terrestrial-and-aquatic-plots-spectral-profiles" class="nav-link" data-scroll-target="#step-3.4-plot-terrestrial-and-aquatic-plots-spectral-profiles">Step 3.4 Plot Terrestrial and Aquatic Plots Spectral Profiles</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">AVIRIS Data - Discovery, Access, and Visualization</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This tutorial will demonstrate Earthdata discovery and direct access of NASA airborne data archived through the ORNL DAAC. We’ll explore archived SBG-relevant airborne data using Earthdata Search and then, through a Notebook Tutorial, programmatically access and visualize Level 3 AVIRIS-Next Generation (ANG) Reflectance dataset collected during the Biodiversity Survey of the Cape (BioSCape) Campaign. BioSCape is an integrated field and airborne campaign in South Africa’s Greater Cape Floristic Region (GCFR) where collections occurred in 2023. The BioSCape Campaign utilzed four NASA airborne instruments to collect UV/visible to short wavelength infrared (UVSWIR) and thermal imaging (TIR) spectroscopy and laser altimetry LiDAR data over terrestrial and aquatic targets. Airborne Visible InfraRed Imaging Spectrometer - Next Generation (AVIRIS-NG), Portable Remote Imaging SpectroMeter (PRISM), Land, Vegetation, and Ice Sensor (LVIS), and Hyperspectral Thermal Emission Spectrometer (HyTES).</p>
<ul>
<li>Learn more about <a href="https://www.bioscape.io/"><strong>BioSCape</strong></a></li>
<li>Nasa Earthdata Search: <a href="https://search.earthdata.nasa.gov/search?fpj=BioSCape"><strong>Discover Earthdata BioSCape Data</strong></a></li>
</ul>
<p>The BioSCape Campaign has produced an AVIRIS-NG L3 Resampled Mosaic dataset.<br>
- Surface reflectance data (Level 2b) derived from the AVIRIS-NG instrument were resampled to 5-m spatial resolution and mosaiced into a regular tile system of 807 tiles. A given tile includes multiple AVIRIS-NG scenes from multiple flight lines spanning multiple days. The mosaics in this dataset were generated by stitching together separate scenes and resampling to 5-m resolution in the Hartebeesthoek94 projected coordinate system (WGS-84 datum, EPSG 9221). The mosaic files are distributed on a tiled grid system, and the tile name is included in the file name. Mosaics were generated by manually grouping sets of flight lines into different chunks that should be placed ‘in front of’ or ‘behind’ other chunks. The selection criteria included a combination of the weather during observations, flight conditions, flightbox design, and the time the flight was taken.</p>
<blockquote class="blockquote">
<p>Brodrick, P.G., A.M. Chlus, R. Eckert, J.W. Chapman, M. Eastwood, S. Geier, M. Helmlinger, S.R. Lundeen, W. Olson-Duvall, R. Pavlick, L.M. Rios, D.R. Thompson, and R.O. Green. 2025. BioSCape: AVIRIS-NG L3 Resampled Reflectance Mosaics, V2. ORNL DAAC, Oak Ridge, Tennessee, USA. <a href="https://doi.org/10.3334/ORNLDAAC/2427">https://doi.org/10.3334/ORNLDAAC/2427</a></p>
</blockquote>
<p>Dataset <a href="https://www.earthdata.nasa.gov/learn/earth-observation-data-basics/data-processing-levels"><strong>Data Processing Levels</strong></a> - <strong>Level 3</strong>: Variables mapped on uniform space-time grid scales, usually with some completeness and consistency.</p>
<p><a href="https://popo.jpl.nasa.gov/mmgis-aviris/?mission=BIOSCAPE"><strong>NASA JPL BioSCape Data Portal</strong></a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/BioSCape_MMGIS_rs70.png" class="img-fluid figure-img"></p>
<figcaption>BioSCape_MMGIS</figcaption>
</figure>
</div>
<ul>
<li><strong>Demo</strong>: Live Demo of Earthdata Search</li>
<li><h2 id="tutorial-programmatic-discovery-and-access-of-airborne-data-bioscape-campaign-aviris-ng-resampled-mosaic-l3-reflectance" class="anchored"><strong>Tutorial</strong>: Programmatic Discovery and Access of Airborne Data: BioSCape Campaign AVIRIS-NG Resampled Mosaic (L3) Reflectance</h2></li>
</ul>
</section>
<section id="demo-earthdata-search---ornl-daac-airborne-facility-instrument-and-campaign-collections" class="level2">
<h2 class="anchored" data-anchor-id="demo-earthdata-search---ornl-daac-airborne-facility-instrument-and-campaign-collections">Demo: Earthdata Search - ORNL DAAC Airborne Facility Instrument and Campaign Collections</h2>
<p><a href="https://search.earthdata.nasa.gov/"><strong>NASA Earthdata Search</strong></a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/earthdatasearch60.png" class="img-fluid figure-img"></p>
<figcaption>Earthdata Search</figcaption>
</figure>
</div>
<hr>
</section>
<section id="tutorial-programmatic-discovery-and-access-of-airborne-data" class="level2">
<h2 class="anchored" data-anchor-id="tutorial-programmatic-discovery-and-access-of-airborne-data">Tutorial: Programmatic Discovery and Access of Airborne Data</h2>
<p><strong>BioSCape Campaign AVIRIS-NG Reflectance Level 3 Mosaic Dataset</strong></p>
<section id="requirements" class="level3">
<h3 class="anchored" data-anchor-id="requirements">Requirements</h3>
<div id="b10d4922-8967-4222-a601-3bd70e44208f" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> earthaccess</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyproj</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyproj <span class="im">import</span> Proj</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.ops <span class="im">import</span> transform</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.ops <span class="im">import</span> orient</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Polygon, MultiPolygon</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hvplot.xarray</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> holoviews <span class="im">as</span> hv</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>hvplot.extension(<span class="st">'bokeh'</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray <span class="im">as</span> rx</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rioxarray <span class="im">import</span> merge</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="step-1-authentication-and-airbone-datasets-search-examples-with-earthaccess" class="level2">
<h2 class="anchored" data-anchor-id="step-1-authentication-and-airbone-datasets-search-examples-with-earthaccess">Step 1: Authentication and Airbone Datasets Search Examples with earthaccess</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/earthaccess.png" class="img-fluid figure-img"></p>
<figcaption>earthaccess</figcaption>
</figure>
</div>
<p><a href="https://www.earthdata.nasa.gov/news/blog/earthaccess-earth-science-data-simplifiedl"><strong><code>earthaccess</code></strong></a> is a Python library that simplifies data discovery and access to NASA Earthdata data by providing an abstraction layer to NASA’s APIs for programmatic access.</p>
<p>In this tutorial we’ll use earthaccess to: - handle authentication with NASA’s Earthdata Login (EDL), - search the NASA Earthdata Data holdings using NASA’s Common Metadata Repository (CMR), and - provide direct cloud file access</p>
<p><strong>Earthdata Login</strong></p>
<p>NASA <a href="https://urs.earthdata.nasa.gov/"><strong><code>Earthdata Login</code></strong></a> is a user registration and profile management system for users getting Earth science data from NASA Earthdata. If you download or access NASA Earthdata data, you need an Earthdata Login.</p>
<p>Using <code>earthaccess</code> we’ll login and authentice to NASA Earthdata Login. - For this exercise, we will be prompted for and interactively enter our Eathdata Login credentials (login, password)</p>
<div id="f23a6149-e091-4e58-8171-6ae2220efcfb" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>auth <span class="op">=</span> earthaccess.login()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="earthaccess-to-search-the-nasa-common-metadata-repository-for-a-specific-airborne-instrument" class="level3">
<h3 class="anchored" data-anchor-id="earthaccess-to-search-the-nasa-common-metadata-repository-for-a-specific-airborne-instrument">1.1 <code>earthaccess</code> to search the NASA Common Metadata Repository for a specific airborne <code>instrument</code></h3>
<div id="0af65a15-f83b-4207-b7ef-c0c6d904363f" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> earthaccess.search_datasets(instrument<span class="op">=</span><span class="st">"AVIRIS-3"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#results = earthaccess.search_datasets(instrument="AVIRIS-NG")</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#results = earthaccess.search_datasets(instrument="AVIRIS") # AVIRIS-Classic</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#results = earthaccess.search_datasets(instrument="MASTER")</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#results = earthaccess.search_datasets(instrument="HYTES")</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#results = earthaccess.search_datasets(instrument="PRISM")</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total Datasets (results) found: </span><span class="sc">{</span><span class="bu">len</span>(results)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>List the short-name for each dataset</p>
<div id="b4ab7776-caca-44cc-abab-8c6b82143f23" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> results:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    summary <span class="op">=</span> item.summary()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(summary[<span class="st">"short-name"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="search-umm-g-for-specific-campaigns" class="level3">
<h3 class="anchored" data-anchor-id="search-umm-g-for-specific-campaigns">1.2 Search UMM-G for Specific Campaigns</h3>
<ul>
<li>AVIRIS-3 datasets contain <code>campaign</code> information in the Unified Metadata Model-Granule (UMM-G) <a href="https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#c-additional-attribute"><code>AdditionalAttributes</code></a></li>
<li>List the campaigns and number of granules in each campaign</li>
<li>Note that at the time of this workshop, this functionality is specific to AVIRIS-3 Datasets</li>
</ul>
<div id="00a570b7-46b1-4d1a-856c-578c83f719bb" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span>  get_campaign_names(granules):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""get campaign names for all granules"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> []</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> g <span class="kw">in</span> granules:</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> attrs <span class="kw">in</span> <span class="bu">vars</span>(g)[<span class="st">'render_dict'</span>][<span class="st">'umm'</span>][<span class="st">'AdditionalAttributes'</span>]:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> attrs[<span class="st">'Name'</span>] <span class="op">==</span> <span class="st">'Campaign'</span>:</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                c <span class="op">+=</span> attrs[<span class="st">'Values'</span>]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># earthdata search</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>granules <span class="op">=</span> earthaccess.search_data(</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#short_name = 'AV3_L1B_RDN_2356',</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    doi<span class="op">=</span><span class="st">"10.3334/ORNLDAAC/2356"</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>campaigns <span class="op">=</span> get_campaign_names(granules)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">#print campaign names and granules</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name <span class="kw">in</span> <span class="bu">list</span>(<span class="bu">set</span>(campaigns)):</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> --&gt; </span><span class="sc">{</span>campaigns<span class="sc">.</span>count(name)<span class="sc">}</span><span class="ss"> granules'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>If you know a Campaign flown with AVIRIS-3, you can directly query the <code>AdditionalAttributes</code></strong></p>
<div id="ec5f28c0-75cb-4250-b2c8-471721ba78f7" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>doi<span class="op">=</span><span class="st">"10.3334/ORNLDAAC/2356"</span> <span class="co"># AV3_L1B_RDN_2356</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> earthaccess.DataGranules().doi(doi)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>query.params[<span class="st">'attribute[]'</span>] <span class="op">=</span> <span class="st">'string,Campaign,SHIFT'</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>l1b <span class="op">=</span> query.get_all()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Granules found: </span><span class="sc">{</span><span class="bu">len</span>(l1b)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="search-by-project-knowing-our-dataset-of-interest-was-part-of-the-bioscape-project." class="level3">
<h3 class="anchored" data-anchor-id="search-by-project-knowing-our-dataset-of-interest-was-part-of-the-bioscape-project.">1.3 Search by <strong><code>Project</code></strong> knowing our dataset of interest was part of the BioSCape project.</h3>
<div id="daf56eff-c433-48b7-b6ab-8909033cb2f7" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> earthaccess.search_datasets(project<span class="op">=</span><span class="st">"BioSCape"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total Datasets (results_projects) found: </span><span class="sc">{</span><span class="bu">len</span>(results)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the instrument==“AVIRIS-NG” search, let’s look at the first result to see all of the CMR values that are returned - The first dataset listed is from the ABoVE Campaign - We see many useful fields for any one dataset including: <code>short-name</code>, <code>concept-id</code>, the <code>S3BucketAndObjectPrefixNames</code></p>
<div id="c4911263-9930-449c-a778-2286cd6be0ce" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, item <span class="kw">in</span> <span class="bu">enumerate</span>(results):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> index <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        summary <span class="op">=</span> item.summary()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s look at <code>short-name</code> for all of the search <strong>results</strong></p>
<div id="11169f91-85c5-44c3-95f2-78d4466ea0af" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> results:</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    summary <span class="op">=</span> item.summary()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(summary[<span class="st">"short-name"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><strong><code>BioSCape_ANG_V02_L3_RFL_Mosaic_2427</code></strong> is the <code>short-name</code> of the dataset of interest for this tutorial.</li>
</ul>
<p>Let’s use <strong><code>earthaccess</code></strong> to query the <a href="https://search.earthdata.nasa.gov/search/granules?p=C3523930138-ORNL_CLOUD"><strong><code>BioSCape: AVIRIS-NG L3 Resampled Reflectance Mosaics, V2</code></strong></a> data to discover the files within that dataset.</p>
<div id="89fd321a-2179-42e3-8925-dd0bad4bceb3" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> earthaccess.search_data(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    short_name <span class="op">=</span> <span class="st">'BioSCape_ANG_V02_L3_RFL_Mosaic_2427'</span>, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total granules found: </span><span class="sc">{</span><span class="bu">len</span>(results)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s look at the first 2 results and examine the details of the granule-level CMR metadata information</p>
<div id="2c333d0a-888a-48cd-bd30-c04a77fedafc" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># granule-level CMR metadata information</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>results[:<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="step-2.-further-define-and-refine-our-search-parameters" class="level2">
<h2 class="anchored" data-anchor-id="step-2.-further-define-and-refine-our-search-parameters">Step 2. Further Define and Refine our Search Parameters</h2>
<section id="define-more-search-parameters-to-limit-our-search" class="level3">
<h3 class="anchored" data-anchor-id="define-more-search-parameters-to-limit-our-search">2.1 Define more search parameters to limit our search</h3>
<ul>
<li><code>bounding_box</code></li>
<li><code>temporal</code> range</li>
<li><code>granule_name</code> refined</li>
</ul>
<p>Let’s first create and visualize a <strong><code>bounding box</code></strong> for an area-of-interest within the South Africa Greater Cape Floristic Region (GCFR) of the BioSCape Campaign</p>
<div id="2188152e-6e98-4cf4-b95b-a1760254935f" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Polygon</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.ops <span class="im">import</span> transform</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyproj</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_geo_bb(coordinates, crs_in<span class="op">=</span><span class="st">'epsg:4326'</span>, crs_out<span class="op">=</span><span class="st">'epsg:4326'</span>):</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    polygon_shape <span class="op">=</span> Polygon(coordinates)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> crs_in <span class="op">!=</span> crs_out:</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>      project_in <span class="op">=</span> pyproj.Proj(init<span class="op">=</span>crs_in)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>      project_out <span class="op">=</span> pyproj.Proj(init<span class="op">=</span>crs_out)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      polygon_shape <span class="op">=</span> transform(pyproj.Transformer.from_proj(project_in, project_out, always_xy<span class="op">=</span><span class="va">True</span>).transform, polygon_shape)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    polygon <span class="op">=</span> gpd.GeoDataFrame(geometry<span class="op">=</span>[polygon_shape], crs<span class="op">=</span>crs_out)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> polygon</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>coordinates <span class="op">=</span> [</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">17.9907</span>, <span class="op">-</span><span class="fl">33.1243</span>),</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">18.2469</span>, <span class="op">-</span><span class="fl">33.1243</span>),</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">18.2469</span>, <span class="op">-</span><span class="fl">33.2817</span>),</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">17.9907</span>, <span class="op">-</span><span class="fl">33.2817</span>),</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">17.9907</span>, <span class="op">-</span><span class="fl">33.1243</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>polygon_gdf <span class="op">=</span> create_geo_bb(coordinates)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(polygon_gdf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1e65dccc-0c68-4252-b0bd-315776a57ec9" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#polygon_gdf.crs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="45a196c6-e51e-4c1c-84be-b6ac72664213" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>polygon_gdf.explore(fill<span class="op">=</span><span class="va">False</span>, tiles<span class="op">=</span><span class="st">'https://mt1.google.com/vt/lyrs=s&amp;x=</span><span class="sc">{x}</span><span class="st">&amp;y=</span><span class="sc">{y}</span><span class="st">&amp;z=</span><span class="sc">{z}</span><span class="st">'</span>, attr<span class="op">=</span><span class="st">'Google'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>We’ll use this bounding box and temporal parameters to refine our search of BioSCape AVIRIS-NG L3 files in our region and time of interest</strong></p>
<p>Again, using <strong><code>earthaccess</code></strong> we can query the <a href="https://search.earthdata.nasa.gov/search/granules?p=C3523930138-ORNL_CLOUD"><strong><code>BioSCape: AVIRIS-NG L3 Resampled Reflectance Mosaics, V2</code></strong></a> data to discover files within the spatial and temporal subset of interest.</p>
<ul>
<li><p>recall we discovered in our Earthdata Search investigation that datasets have NASA Earthdata Unique Identifiers (e.g.&nbsp;DOI, ConceptID, short_name)</p></li>
<li><p>Dataset of interest short_name: <strong><code>BioSCape_ANG_V02_L3_RFL_Mosaic_2427</code></strong></p></li>
<li><p>The BioSCape Airborne Campaign took place from 2023-10-22 to 2023-11-26</p></li>
</ul>
<div id="71c3ec6c-ae0f-4c75-a176-59d4c2301e0f" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bounding lon, lat as a list of tuples</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> polygon_gdf.geometry.<span class="bu">apply</span>(orient, args<span class="op">=</span>(<span class="dv">1</span>,))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># simplifying the polygon to bypass the coordinates </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># limit of the CMR with a tolerance of .01 degrees</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>xy <span class="op">=</span> bounds.simplify(<span class="fl">0.01</span>).get_coordinates()</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>date_range <span class="op">=</span> (<span class="st">"2023-10-22"</span>, <span class="st">"2023-11-26"</span>)  </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> earthaccess.search_data(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    short_name <span class="op">=</span> <span class="st">'BioSCape_ANG_V02_L3_RFL_Mosaic_2427'</span>, </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    polygon<span class="op">=</span><span class="bu">list</span>(<span class="bu">zip</span>(xy.x, xy.y)),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    temporal <span class="op">=</span> date_range,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    granule_name<span class="op">=</span>(<span class="st">'*AVIRIS-NG_BIOSCAPE_V02_L3*'</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total granules found: </span><span class="sc">{</span><span class="bu">len</span>(results)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>For our search parameters, let’s explore the granules found</strong><br>
- Let’s look at the first result</p>
<div id="7945ac35-00a9-4021-a150-4964a61f9efd" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>results[:<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e573cc7a-fcf8-40e2-b44b-f4aadf0f8d71" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>results[<span class="dv">7</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>You can download these files directly to your local machine by clicking on any of the files</strong> - We also see that these data are <strong>Cloud Hosted:</strong> True</p>
</section>
<section id="create-and-visualize-the-bounding-boxes-of-the-subset-of-files" class="level3">
<h3 class="anchored" data-anchor-id="create-and-visualize-the-bounding-boxes-of-the-subset-of-files">2.2 Create and Visualize the <strong><code>Bounding Boxes</code></strong> of the subset of files</h3>
<p>From each granule, we’ll use the CMR <code>Geometry</code> information to create a plot of the AVIRIS-3 flight lines from our temporal and spatial subset</p>
<p>Below, we define two functions to plot the search results over a basemap - Function 1: converts UMM geometry to multipolygons – <code>UMM</code> stands for NASA’s Unified Metadata Model - Function 2: converts the Polygon List [ ] to a <strong><code>geopandas</code></strong> dataframe</p>
<div id="0fb23c49-3324-42a3-a375-687eacfa1093" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_umm_geometry(gpoly):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""converts UMM geometry to multipolygons"""</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    multipolygons <span class="op">=</span> []</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gl <span class="kw">in</span> gpoly:</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        ltln <span class="op">=</span> gl[<span class="st">"Boundary"</span>][<span class="st">"Points"</span>]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        points <span class="op">=</span> [(p[<span class="st">"Longitude"</span>], p[<span class="st">"Latitude"</span>]) <span class="cf">for</span> p <span class="kw">in</span> ltln]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        multipolygons.append(Polygon(points))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> MultiPolygon(multipolygons)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_list_gdf(datag):</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""converts List[] to geopandas dataframe"""</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create pandas dataframe from json</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.json_normalize([<span class="bu">vars</span>(granule)[<span class="st">'render_dict'</span>] <span class="cf">for</span> granule <span class="kw">in</span> datag])</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep only last string of the column names</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    df.columns<span class="op">=</span>df.columns.<span class="bu">str</span>.split(<span class="st">'.'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert polygons to multipolygonal geometry</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"geometry"</span>] <span class="op">=</span> df[<span class="st">"GPolygons"</span>].<span class="bu">apply</span>(convert_umm_geometry)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return geopandas dataframe</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gpd.GeoDataFrame(df, geometry<span class="op">=</span><span class="st">"geometry"</span>, crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>subset_gdf <span class="op">=</span> convert_list_gdf(results)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>subset_gdf.crs</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co">#subset_gdf.drop('Version', axis=1, inplace=True)</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co">#subset_gdf.explore(fill=False, tiles='https://mt1.google.com/vt/lyrs=s&amp;x={x}&amp;y={y}&amp;z={z}', attr='Google')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="45c6f1ae-de42-4c83-b53c-0904efa7a377" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let's visualize the bounding boxes of the selected files</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>subset_gdf <span class="op">=</span> convert_list_gdf(results)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>mapObj <span class="op">=</span> folium.Map(location<span class="op">=</span>[<span class="op">-</span><span class="fl">33.1456</span>, <span class="fl">18.0622</span>], zoom_start<span class="op">=</span><span class="dv">11</span>, control_scale<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#-118.2036, 34.2705</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#folium.GeoJson(gdf).add_to(mapObj)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>subset_gdf.drop(<span class="st">'Version'</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>folium.GeoJson(subset_gdf, name<span class="op">=</span><span class="st">"SUBSET FLIGHT LINES"</span>, color<span class="op">=</span><span class="st">"blue"</span>, style_function<span class="op">=</span><span class="kw">lambda</span> x: {<span class="st">"fillOpacity"</span>: <span class="dv">0</span>}).add_to(mapObj)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>folium.GeoJson(polygon_gdf, name<span class="op">=</span><span class="st">"LA FIRE SUBSET AREA"</span>, color<span class="op">=</span><span class="st">"white"</span>, style_function<span class="op">=</span><span class="kw">lambda</span> x: {<span class="st">"fillOpacity"</span>: <span class="dv">0</span>}).add_to(mapObj)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#folium.GeoJson(lasubset, name="SUBSET FLIGHT LINES", style_function=lambda x: {"fillOpacity": 0}).add_to(mapObj)</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># create ESRI satellite base map</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>esri <span class="op">=</span> <span class="st">'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">'</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>folium.TileLayer(tiles <span class="op">=</span> esri, attr <span class="op">=</span> <span class="st">'Esri'</span>, name <span class="op">=</span> <span class="st">'Esri Satellite'</span>, overlay <span class="op">=</span> <span class="va">False</span>, control <span class="op">=</span> <span class="va">True</span>).add_to(mapObj)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>folium.LayerControl().add_to(mapObj)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>mapObj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Let’s add the <code>GranuleUR</code> to the visualization of the selected tile bounding boxes</strong></p>
<div id="8b487f42-af37-4640-8174-a3eb884e1d0d" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualize the selected tile bounding boxes and the GranuleUR</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#m = AVNG_CP[['fid','geometry']].explore('fid')</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> subset_gdf[[<span class="st">'GranuleUR'</span>, <span class="st">'geometry'</span>]].explore(<span class="st">'GranuleUR'</span>, tiles<span class="op">=</span><span class="st">'https://mt1.google.com/vt/lyrs=s&amp;x=</span><span class="sc">{x}</span><span class="st">&amp;y=</span><span class="sc">{y}</span><span class="st">&amp;z=</span><span class="sc">{z}</span><span class="st">'</span>, attr<span class="op">=</span><span class="st">'Google'</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#explore('LandType', tiles='https://mt1.google.com/vt/lyrs=s&amp;x={x}&amp;y={y}&amp;z={z}', attr='Google')</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>We have a subset of files of interest for our region of interest. Now let’s see how to access those files</strong></p>
</section>
</section>
<section id="step-3.-cloud-based-access-methods" class="level2">
<h2 class="anchored" data-anchor-id="step-3.-cloud-based-access-methods">Step 3. Cloud-based Access Methods</h2>
<p>Datasets in NASA Earthdata Cloud - NASA Earthdata is in AMAZON AWS us-west-2 region (physically in Oregon) - Most data are in AWS Cloud Data Storage (S3) Buckets in this cloud - Access Earthdata Cloud from another Cloud that is in the same region - the openscapes 2i2c Hub is in that region - Airborne (AVIRIS) files can be big, processinge it in the cloud may be advantageous, saving your local device storage</p>
<p><strong>Recall from our earthaccess search <code>results</code>, each granule of the dataset has 3 data files:</strong> - <strong><code>*_QL.tif</code></strong> - <strong><code>*_RFL.nc</code></strong> - <strong><code>*_UNC.nc</code></strong></p>
<p>Let’s use the <code>results</code> from earthaccess API search to display the <a href="https://earthaccess.readthedocs.io/en/latest/user-reference/granules/granules/#earthaccess.results.DataGranule.data_links"><code>data_links</code></a> of the Quick Look geoTIFF files</p>
<div id="530fbf99-ecca-4505-bb57-3646bd8d9871" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_s3_links(g, suffix_str):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [i <span class="cf">for</span> i <span class="kw">in</span> g.data_links(access<span class="op">=</span><span class="st">"direct"</span>) <span class="cf">if</span> i.endswith(suffix_str)][<span class="dv">0</span>]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>tif_f <span class="op">=</span> []</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> results:</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    tif_f.append(get_s3_links(g, <span class="st">'QL.tif'</span>))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>tif_f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="directly-open-and-access-nasa-earthdata-from-the-aws-s3-session" class="level3">
<h3 class="anchored" data-anchor-id="directly-open-and-access-nasa-earthdata-from-the-aws-s3-session">3.1 Directly Open and Access NASA Earthdata from the AWS S3 Session</h3>
<p>Calling open( ) from the <strong><code>earthaccess</code></strong> API library on an S3FileSystem object… - returns an S3File object, which mimics the standard Python file protocol, allowing you to read and write data to S3 objects - returns a list of file-like objects that can be used to access files hosted on S3 third party libraries like xarray - <strong><code>*_paths</code></strong> contains references to files on the remote filesystem. The <code>ornl-cumulus-prod-public</code> is the S3 bucket in AWS us-west-2 region</p>
<div id="2e672b70-f88f-45fa-9db9-17808ead76fd" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>gtiff_paths <span class="op">=</span> earthaccess.<span class="bu">open</span>(tif_f, provider<span class="op">=</span><span class="st">"ORNL_CLOUD"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="80b03ce3-e206-4b86-be7b-947cd4cad88c" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>gtiff_paths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we’ve opened the S3 objects, we can treat them as if they are local files.</p>
<p>Let’s open and visualize the geoTIFF files using familiar Python packages like rioxarray - First we’ll determine the crs and visualize one file</p>
<div id="8a681a4b-f1a6-429b-94ea-d33211753e15" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(gtiff_paths[<span class="dv">7</span>]) <span class="im">as</span> dataset:</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the CRS</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    crs <span class="op">=</span> dataset.crs </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The CRS of the GeoTIFF is: </span><span class="sc">{</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The type of CRS is: </span><span class="sc">{</span><span class="bu">type</span>(crs)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s add and visualize a plot location. We’ll create a spectral profile of this plot location in a subsequent code block.</p>
<div id="993e6998-7d51-431b-93fd-131883128b1f" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>terr_lat <span class="op">=</span> <span class="op">-</span><span class="fl">33.1733</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>terr_lon <span class="op">=</span> <span class="fl">18.1374</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>aqua_lat <span class="op">=</span> <span class="op">-</span><span class="fl">33.1925</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>aqua_lon <span class="op">=</span> <span class="fl">18.1166</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># translate coordinates</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyproj <span class="im">import</span> Proj</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> Proj(<span class="st">"EPSG:3857"</span>, preserve_units<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>terr_x,terr_y <span class="op">=</span> p(terr_lon, terr_lat)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>aqua_x, aqua_y <span class="op">=</span> p(aqua_lon, aqua_lat)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'terr_easting:'</span>, terr_x)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'terr_northing'</span>, terr_y)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'aqua_easting:'</span>, aqua_x)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'aqua_northing'</span>, aqua_y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualize the tile geoTIFF and plot location</p>
<div id="c7dc3d25-1819-41a9-9cd7-64875499099f" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the GeoTIFF file</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>raster <span class="op">=</span> rx.open_rasterio(gtiff_paths[<span class="dv">7</span>])</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the RGB image</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>raster.plot.imshow(rgb<span class="op">=</span><span class="st">"band"</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(terr_x,terr_y, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(aqua_x,aqua_y, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now we’ll merge the 8 files and visualize the data available over our region of interest</p>
<div id="b94be7bf-4734-442d-acb0-1027c6224c78" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>data_arrays <span class="op">=</span> []</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> gtiff_paths:</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    data_arrays.append(rx.open_rasterio(g))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>merged_array <span class="op">=</span> rx.merge.merge_arrays(data_arrays, method<span class="op">=</span><span class="st">'last'</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>merged_array.rio.to_raster(<span class="st">'merged_image.tif'</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.figure(figsize=(10, 10))</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">#merged_array.plot.imshow(rgb='band')</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="2d3b3c68-9a21-434b-a119-8efd809aaa10" class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ANG_L3_EPSG <span class="op">=</span> <span class="st">'EPSG:3857'</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>subset_gdf_9221 <span class="op">=</span> subset_gdf.to_crs(ANG_L3_EPSG)  </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>merged_array.plot.imshow(rgb<span class="op">=</span><span class="st">'band'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>subset_gdf_9221.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-3.2-list-s3-links-for-mosaic-aviris-ng-425-band-reflectance-netcdf-files" class="level3">
<h3 class="anchored" data-anchor-id="step-3.2-list-s3-links-for-mosaic-aviris-ng-425-band-reflectance-netcdf-files">Step 3.2 List S3 Links for Mosaic AVIRIS-NG 425-band Reflectance netCDF Files</h3>
<ul>
<li>Again, we’ll use the <code>results</code> from earthaccess API search to display the <a href="https://earthaccess.readthedocs.io/en/latest/user-reference/granules/granules/#earthaccess.results.DataGranule.data_links"><code>data_links</code></a> of the netCDF files</li>
</ul>
<div id="985140bb-775f-4004-b481-f8108041ad3b" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_s3_links(g, suffix_str):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [i <span class="cf">for</span> i <span class="kw">in</span> g.data_links(access<span class="op">=</span><span class="st">"direct"</span>) <span class="cf">if</span> i.endswith(suffix_str)][<span class="dv">0</span>]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>rfl_f <span class="op">=</span> []</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> results:</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    rfl_f.append(get_s3_links(g, <span class="st">'RFL.nc'</span>))</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>rfl_f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Recall that these are Multifile Granules with 3 files per Granule. We’ve selected just the netCDF files in</strong> <strong><code>granule_arr</code></strong></p>
</section>
<section id="step-3.3-directly-open-access-and-visualize-aviris-ng-mosaic-data-from-the-aws-s3-session" class="level3">
<h3 class="anchored" data-anchor-id="step-3.3-directly-open-access-and-visualize-aviris-ng-mosaic-data-from-the-aws-s3-session">Step 3.3 Directly Open, Access, and Visualize AVIRIS-NG Mosaic Data from the AWS S3 Session</h3>
<p>Using <strong><code>xarray</code></strong> and the <strong><code>earthaccess.open</code></strong> function we can directly read from a remote filesystem, but not download a file.</p>
<div id="c5ea37f2-a65a-4d8f-99dd-4202e0a67d7f" class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span> earthaccess.<span class="bu">open</span>(rfl_f, provider<span class="op">=</span><span class="st">"ORNL_CLOUD"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="70dd3af4-5460-4c3e-86a2-4c6428a0f139" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>paths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="babbcd80-df4b-4706-bf79-8d5c9de191b1" class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ds_set <span class="op">=</span> xr.open_dataset(paths[<span class="dv">7</span>], engine<span class="op">=</span><span class="st">"h5netcdf"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>ds_set</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that this <code>xarray.Dataset</code> is limited in what is showing and has no variables.</p>
<p><strong>The netCDF data model for these data includes multi-group hierarchies within a single file where each <code>group</code> maps to an xarray.Dataset</strong> - In xarray, it is recommended to use DataTree to represent hierarchical data &gt;netCDF groups can only be loaded individually as Dataset objects, a whole file of many nested groups can be loaded as a single xarray.DataTree object. To open a whole netCDF file as a tree of groups use the xarray.open_datatree() function. - This implementation in XArray is decribed here: https://docs.xarray.dev/en/stable/user-guide/io.html</p>
<div id="a8612109-f8b5-4073-9f58-96f7d0aa251f" class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> xr.open_datatree(paths[<span class="dv">7</span>], engine<span class="op">=</span><span class="st">"h5netcdf"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we see that the netCDF files contains Groups (3) - reflectance - obs - scene info</p>
<p>We’ll open the file again as a datatree, and then convert it to a dataset with the <code>reflectance</code> variable</p>
<div id="1b657e1d-8aa6-4f54-a126-29bb87cca108" class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>rfl_ds <span class="op">=</span> xr.open_datatree(paths[<span class="dv">7</span>], </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                              engine<span class="op">=</span><span class="st">'h5netcdf'</span>).reflectance.to_dataset()</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>rfl_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we’ll subset the wavelenghts that correspond to RGB bands and visualize the true color image with holoview</p>
<div id="397f12d7-22f9-4076-bc73-81b3fa0f260f" class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ds_rgb <span class="op">=</span> rfl_ds.reflectance.sel(wavelength<span class="op">=</span>[<span class="dv">637</span>, <span class="dv">552</span>, <span class="dv">462</span>], method<span class="op">=</span><span class="st">"nearest"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="46f0d738-e43c-45a3-b5c3-04c4cb42e49a" class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ds_rgb.hvplot.rgb(<span class="st">'easting'</span>, <span class="st">'northing'</span>, rasterize<span class="op">=</span><span class="va">True</span>,robust<span class="op">=</span><span class="va">True</span>, data_aspect<span class="op">=</span><span class="dv">1</span>, aspect<span class="op">=</span><span class="st">'equal'</span>, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                  bands<span class="op">=</span><span class="st">'wavelength'</span>, frame_width<span class="op">=</span><span class="dv">600</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="740952ec-1144-4d02-bd8b-16f30ae0f08e" class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#### false color composite</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">#ds_fcc = rfl_ds.reflectance.sel(wavelength=[800, 637, 552], method="nearest")</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ds_fcc.hvplot.rgb('easting', 'northing', rasterize=True,robust=True, data_aspect=1, aspect='equal', </span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                  bands='wavelength', frame_width=600)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="616fb039-f42e-4a58-b273-2968722f589f" class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#### The Minimum Noise Fraction transformation (MNF) composite images (B456, B546, and B561), can be used to enhance the delineation of different rock types</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#ds_mnf = rfl_ds.reflectance.sel(wavelength=[456, 546, 561], method="nearest")</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ds_mnf.hvplot.rgb('easting', 'northing', rasterize=True,robust=True, data_aspect=1, aspect='equal', </span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                  bands='wavelength', frame_width=600)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-3.4-plot-terrestrial-and-aquatic-plots-spectral-profiles" class="level3">
<h3 class="anchored" data-anchor-id="step-3.4-plot-terrestrial-and-aquatic-plots-spectral-profiles">Step 3.4 Plot Terrestrial and Aquatic Plots Spectral Profiles</h3>
<p>Convert the latitude longitude plots to the AVIRIS-NG netCDF files projection</p>
<div id="a19016c8-5070-4c8e-9cfe-04ed445df154" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#latitude = -33.1733</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#longitude = 18.1374</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># translate coordinates</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#from pyproj import Proj</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> Proj(<span class="st">"EPSG:9221"</span>, preserve_units<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>terr_x,terr_y <span class="op">=</span> p(terr_lon, terr_lat)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'terr_easting:'</span>,terr_x)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'terr_northing'</span>, terr_y)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>aqua_x,aqua_y <span class="op">=</span> p(aqua_lon, aqua_lat)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'aqua_easting:'</span>, aqua_x)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'aqua_northing'</span>, aqua_y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define a list of bands that are atmospheric windows to avoid in plotting</p>
<div id="6b192841-b9c4-4bb5-a4fd-ad60b6fdadf8" class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a list of wavelengths that are "bad" </span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>bblist <span class="op">=</span> np.ones((<span class="dv">425</span>,))  <span class="co"># create a 1D array with values ones</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set tails and atmospheric window to zero</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>bblist[<span class="dv">0</span>:<span class="dv">14</span>] <span class="op">=</span> <span class="dv">0</span>        <span class="co"># tail</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>bblist[<span class="dv">193</span>:<span class="dv">210</span>] <span class="op">=</span> <span class="dv">0</span>     <span class="co"># atmospheric window</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>bblist[<span class="dv">281</span>:<span class="dv">320</span>] <span class="op">=</span> <span class="dv">0</span>     <span class="co"># atmospheric window</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>bblist[<span class="dv">405</span>:] <span class="op">=</span> <span class="dv">0</span>        <span class="co"># tail</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Select and plot the spectral profiles from the terrestrial and aquatic plot locations nearest pixel</p>
<div id="ef301826-82d1-4c71-8d8c-db7173102d11" class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare spectra from a terrestrial and aquatic plot</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>terr_plot <span class="op">=</span> rfl_ds.reflectance.sel(easting<span class="op">=</span>terr_x, northing<span class="op">=</span>terr_y, method<span class="op">=</span><span class="st">'nearest'</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>terr_plot[bblist <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> np.nan</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>aqua_plot <span class="op">=</span> rfl_ds.reflectance.sel(easting<span class="op">=</span>aqua_x, northing<span class="op">=</span>aqua_y, method<span class="op">=</span><span class="st">'nearest'</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>aqua_plot[bblist <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> np.nan</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>terr_plot.plot.line(ylim<span class="op">=</span>(<span class="dv">0</span>,<span class="fl">.4</span>), color <span class="op">=</span> <span class="st">'g'</span>, label<span class="op">=</span><span class="st">"Terrestrial Plot"</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>aqua_plot.plot.line(ylim<span class="op">=</span>(<span class="dv">0</span>,<span class="fl">.4</span>),color <span class="op">=</span> <span class="st">'b'</span>, label<span class="op">=</span><span class="st">"Aquatic Plot"</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> [<span class="dv">10</span>,<span class="dv">7</span>]</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'AVIRIS-NG wavelength'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'reflectance'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"upper left"</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These next block of code will merge the selected files. We will not run this during the workshop. uncomment to run.</p>
<div id="727e729f-6526-47e5-99a1-295095b5eab7" class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#s3_obj = []</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">#for fh in paths:</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    s3_obj.append(xr.open_datatree(fh, engine='h5netcdf', </span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  ).reflectance.to_dataset())</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">#ds = xr.combine_by_coords(s3_obj, combine_attrs='override')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/NEONScience\.github\.io\/neon-nasa-hsi-workshop\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>NASA and NEON Airborne Hyperspectral Workshop - ESA 2025</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>