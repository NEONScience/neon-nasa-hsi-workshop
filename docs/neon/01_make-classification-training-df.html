<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Create a training dataset for tree classification using TOS vegetation structure data.">

<title>Make Training Data for Species Modeling from NEON TOS Vegetation Structure Data – NEON AOP &amp; NASA AVIRIS Airborne and Field Data Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../neon/02_neon-refl-classification.html" rel="next">
<link href="../background/nasa_neon_comparison.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-bb05f5d0074da2129d766b238819cd35.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-cb4c65b174a86268c128f8f7175eb5ec.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-bb05f5d0074da2129d766b238819cd35.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../neon/01_make-classification-training-df.html">Tutorials</a></li><li class="breadcrumb-item"><a href="../neon/01_make-classification-training-df.html">1 NEON - Make a Training Dataset from Vegetation Structure Data</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../img/ornl_daac_neon_combined_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">NEON AOP &amp; NASA AVIRIS Airborne Hyperspectral Data Workshop</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://NEONScience.github.io/neon-nasa-hsi-workshop/" title="NEON NASA Hyperspectral Workshop Website" class="quarto-navigation-tool px-1" aria-label="NEON NASA Hyperspectral Workshop Website"><i class="bi bi-globe"></i></a>
    <a href="https://github.com/NEONScience/neon-nasa-hsi-workshop" title="NEON NASA Repository" class="quarto-navigation-tool px-1" aria-label="NEON NASA Repository"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Welcome</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2025 ESA Workshop</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../neon-nasa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Repository Description</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../instructor-bios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instructors</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Setup Instructions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup/prerequisites.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prerequisites</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup/workshop_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cloud Workspace Setup</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup/setup_instructions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Local Python Environment Setup</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Background</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../background/neon_background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NEON Airborne Data Background</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../background/nasa_airborne_background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NASA Airborne Data Background</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../background/nasa_neon_comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Comparing NEON and NASA Airborne Campaigns</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../neon/01_make-classification-training-df.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">1 NEON - Make a Training Dataset from Vegetation Structure Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../neon/02_neon-refl-classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2 NEON - Reflectance Visualization and Classification</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Code of Conduct</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../CODE_OF_CONDUCT.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NEON’s Code of Conduct</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../neon/01_make-classification-training-df.html">Tutorials</a></li><li class="breadcrumb-item"><a href="../neon/01_make-classification-training-df.html">1 NEON - Make a Training Dataset from Vegetation Structure Data</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Make Training Data for Species Modeling from NEON TOS Vegetation Structure Data</h1>
</div>

<div>
  <div class="description">
    Create a training dataset for tree classification using TOS vegetation structure data.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bridget Hass </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div id="ds-objectives" data-markdown="1">
<p>This notebook demonstrates how to generate a training dataset consisting of tree species, family, and location from the NEON Terrestrial Observation System (TOS) Vegetation Structure data product <a href="https://data.neonscience.org/data-products/DP1.10098.001" target="_blank">DP1.10098.001</a>. We will use data from the <a href="https://www.neonscience.org/field-sites/serc" target="_blank">Smithsonian Environmental Research Center (SERC)</a> site in Maryland. In a subsequent tutorial titled <a href="https://www.neonscience.org/resources/learning-hub/tutorials/refl-classification-pyxarray" target="_blank">Tree Classification with NEON Airborne Imaging Spectrometer Data using Python xarray</a>, we will use this training dataset to train a random forest machine learning model that predicts tree families from the hyperspectral signatures obtained from the airborne remote sensing data. These two tutorials outline a relatively simple modeling example, and represent a starting point for conducting machine learning analyses using NEON data!</p>
<section id="learning-objectives" class="level3">
<h3 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h3>
<ul>
<li>Use the <code>neonutilities</code> <code>load_by_product</code> function to read in NEON vegetation structure data at a given site</li>
<li>Use the NEON locations API to determine the geographic position of the vegetation records in UTM x, y coordinates</li>
<li>Filter the datset to include only the latest data and columns of interest</li>
<li>Filter the data geospatially to keep data that are within a single AOP 1 km x 1 km tile</li>
</ul>
</section>
<section id="additional-resources" class="level3">
<h3 class="anchored" data-anchor-id="additional-resources">Additional Resources</h3>
<ul>
<li><p>The lesson <a href="https://www.neonscience.org/resources/learning-hub/tutorials/tree-heights-veg-structure-chm" target="_blank">Compare tree height measured from the ground to a Lidar-based Canopy Height Model</a> is another example of linking ground to airborne data, and shows similar steps of pre-processing TOS woody vegetation data.</p></li>
<li><p>The paper <a href="https://journals.plos.org/plosbiology/article?id=10.1371/journal.pbio.3002700" target="_blank">Individual canopy tree species maps for the National Ecological Observatory Network</a> outlines methods for large-scale classification using NEON data. The associated NEON Science Seminar <a href="https://www.neonscience.org/get-involved/events/science-seminar-harnessing-neon-enable-future-forest-remote-sensing" target="_blank">Harnessing NEON to enable the future of forest remote sensing</a> may be a useful resource. This talk provides a high-level overview of modeling approaches for tree crown delineation and tree classification using NEON airborne remote sensing data. You can also watch the video below.</p></li>
</ul>
<p align="center">
<iframe src="https://www.youtube.com/embed/Weru3hJbwTs" title="Science Seminar: Harnessing NEON to enable the future of forest remote sensing" frameborder="0" allowfullscreen="">
</iframe>
</p><ul>
<li>Refer to the <a href="https://data.neonscience.org/api/v0/documents/NEON_vegStructure_userGuide_vE?inline=true" target="_blank">Vegetation Structure User Guide</a> for more details on this data product, and to better understand the data quality flags, the sampling.</li>
</ul>
<p><strong>Disclaimer</strong>: this notebook is intended to provide an example of how to create an initial training data set for pairing with remote sensing data, and to conduct some exploratory analysis of the vegetation structure data. This does not incorporate outlier detection and removal, or comprehensive pre-processing steps. As part of creating a machine learning model, it is important to assess the training data quality and look for outliers or other potential data quality issues which may impact model results. Refer to the <a href="https://www.neonscience.org/resources/learning-hub/tutorials/tree-heights-veg-structure-chm" target="_blank">Compare tree height measured from the ground to a Lidar-based Canopy Height Model</a> lesson (the first additional resource above) for more details on how you would address geographic mismatch between the AOP and TOS data.</p>
</section></div>
<p>Let’s get started! First, import the required Python packages.</p>
<div id="cell-2" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> mticker</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neonutilities <span class="im">as</span> nu</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<section id="download-and-explore-vegetation-structure-data-dp1.10098.001" class="level2">
<h2 class="anchored" data-anchor-id="download-and-explore-vegetation-structure-data-dp1.10098.001">Download and Explore Vegetation Structure Data (DP1.10098.001)</h2>
<p>In this first section we’ll load the vegetation structure data, find the locations of the mapped trees, and join to the species and family observations.</p>
<p>Download the vegetation structure data using the <code>load_by_product</code> function in the <code>neonutilities</code> package (imported as <code>nu</code>). Inputs to the function can be shown by typing <code>help(load_by_product)</code>.</p>
<p>Refer to t e&lt;a href”=https://www.neonscience.org/sites/default/files/cheat-sheet-neonUtilities.pd”f target=_blank R neonutilities cheat sheet or the neonUtilities package for more details and the complete index of possible function inputs. The cheat sheet is focused on the R package, but nearly all the inputs are the sam.e</p>
<p>Note that in this example, we will pull in all the woody vegetation data (collected over all years), but if you are trying to modeldata collected in a single year, you can select just that year by specifying the <code>startdate</code> and <code>enddate</code>, or later filtering out the vegetation data by the<code>eventI</code>D We have set <code>check_size=False</code> since the data are not very large, but to check the size of what the data you are downloading first, you could omit this input, or set it to <code>True</code>..</p>
<div id="cell-4" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>veg_dict <span class="op">=</span> nu.load_by_product(dpid<span class="op">=</span><span class="st">"DP1.10098.001"</span>, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                              site<span class="op">=</span><span class="st">"SERC"</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                              package<span class="op">=</span><span class="st">"basic"</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                              release<span class="op">=</span><span class="st">"RELEASE-2025"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                              check_size<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Finding available files
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:56&lt;00:00,  2.46s/it]
Downloading 23 NEON DP1.10098.001 files totaling approximately 40.0 MB.
Downloading files
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:24&lt;00:00,  1.07s/it]
C:\Users\bhass\.conda\envs\lpdaac_vitals\lib\site-packages\neonutilities\unzip_and_stack.py:140: UserWarning: Filepaths on Windows are limited to 260 characters. Attempting to extract a filepath that is &gt; 260 characters long. Move your working or savepath directory closer to the root directory or enable long path support in Windows.
  warnings.warn(
Stacking data files
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:01&lt;00:00,  2.38it/s]</code></pre>
</div>
</div>
<p>Get a list of the points</p>
<div id="cell-6" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>veg_map_all <span class="op">=</span> veg_dict[<span class="st">"vst_mappingandtagging"</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>veg_map <span class="op">=</span> veg_map_all.loc[veg_map_all[<span class="st">"pointID"</span>] <span class="op">!=</span> <span class="st">""</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>veg_map <span class="op">=</span> veg_map.reindex()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>veg_map[<span class="st">"points"</span>] <span class="op">=</span> veg_map[<span class="st">"namedLocation"</span>] <span class="op">+</span> <span class="st">"."</span> <span class="op">+</span> veg_map[<span class="st">"pointID"</span>]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>veg_points <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(<span class="bu">list</span>(veg_map[<span class="st">"points"</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Look at the unique <code>eventID</code>s. . All sampling at a site that occurs within a given bout is identified by a unique eventID, which represents the date of the bout.</p>
<div id="cell-8" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>veg_map_all.eventID.unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>array(['vst_SERC_2015', 'vst_SERC_2016', 'vst_SERC_2017', 'vst_SERC_2018',
       'vst_SERC_2019', 'vst_SERC_2020', 'vst_SERC_2021', 'vst_SERC_2022',
       'vst_SERC_2023'], dtype=object)</code></pre>
</div>
</div>
<p>Get the number of records for each <code>eventID</code>:</p>
<div id="cell-10" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by 'eventID' and get the count</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>eventID_counts <span class="op">=</span> veg_map_all[[<span class="st">'individualID'</span>,<span class="st">'eventID'</span>]].groupby([<span class="st">'eventID'</span>]).count()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Counts of each eventID:</span><span class="ch">\n</span><span class="st">"</span>, eventID_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Counts of each eventID:
                individualID
eventID                    
vst_SERC_2015          1890
vst_SERC_2016          1330
vst_SERC_2017            96
vst_SERC_2018           127
vst_SERC_2019           254
vst_SERC_2020            22
vst_SERC_2021            54
vst_SERC_2022           494
vst_SERC_2023            40</code></pre>
</div>
</div>
<p>It looks like most of the trees were mapped in 2015 and 2016, which was when the SERC plots were first established. You could look at data only from one year, and compare to AOP data from the same year, or if you are not too worried about matching measurements to remote sensing data collected in the same year, you could use all years. We’ll do the latter in this example.</p>
</section>
<section id="determine-the-geographic-location-of-the-surveyed-vegetation" class="level2">
<h2 class="anchored" data-anchor-id="determine-the-geographic-location-of-the-surveyed-vegetation">Determine the geographic location of the surveyed vegetation</h2>
<p>Loop through all of the points in <code>veg_points</code> to determine the easting and norhting from the <a href="https://data.neonscience.org/data-api/endpoints/locations/" target="_blank">NEON Locations API</a>.</p>
<div id="cell-13" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>easting <span class="op">=</span> []</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>northing <span class="op">=</span> []</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>coord_uncertainty <span class="op">=</span> []</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>elev_uncertainty <span class="op">=</span> []</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> veg_points:</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    vres <span class="op">=</span> requests.get(<span class="st">"https://data.neonscience.org/api/v0/locations/"</span><span class="op">+</span>i)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    vres_json <span class="op">=</span> vres.json()</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    easting.append(vres_json[<span class="st">"data"</span>][<span class="st">"locationUtmEasting"</span>])</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    northing.append(vres_json[<span class="st">"data"</span>][<span class="st">"locationUtmNorthing"</span>])</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    props <span class="op">=</span> pd.DataFrame.from_dict(vres_json[<span class="st">"data"</span>][<span class="st">"locationProperties"</span>])</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    cu <span class="op">=</span> props.loc[props[<span class="st">"locationPropertyName"</span>]<span class="op">==</span><span class="st">"Value for Coordinate uncertainty"</span>][<span class="st">"locationPropertyValue"</span>]</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    coord_uncertainty.append(cu[cu.index[<span class="dv">0</span>]])</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    eu <span class="op">=</span> props.loc[props[<span class="st">"locationPropertyName"</span>]<span class="op">==</span><span class="st">"Value for Elevation uncertainty"</span>][<span class="st">"locationPropertyValue"</span>]</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    elev_uncertainty.append(eu[eu.index[<span class="dv">0</span>]])</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>pt_dict <span class="op">=</span> <span class="bu">dict</span>(points<span class="op">=</span>veg_points, </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>               easting<span class="op">=</span>easting,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>               northing<span class="op">=</span>northing,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>               coordinateUncertainty<span class="op">=</span>coord_uncertainty,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>               elevationUncertainty<span class="op">=</span>elev_uncertainty)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>pt_df <span class="op">=</span> pd.DataFrame.from_dict(pt_dict)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>pt_df.set_index(<span class="st">"points"</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>veg_map <span class="op">=</span> veg_map.join(pt_df, </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                     on<span class="op">=</span><span class="st">"points"</span>, </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                     how<span class="op">=</span><span class="st">"inner"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, use the <code>stemDistance</code> and <code>stemAzimuth</code> data to calculate the precise locations of individuals, relative to the reference locations.</p>
<ul>
<li><span class="math inline">\(Easting = easting.pointID + stemDistance*sin(\theta)\)</span></li>
<li><span class="math inline">\(Northing = northing.pointID + stemDistance*cos(\theta)\)</span></li>
<li><span class="math inline">\(\theta = stemAzimuth*\pi/180\)</span></li>
</ul>
<p>Also adjust the coordinate and elevation uncertainties.</p>
<div id="cell-15" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>veg_map[<span class="st">"adjEasting"</span>] <span class="op">=</span> (veg_map[<span class="st">"easting"</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                        <span class="op">+</span> veg_map[<span class="st">"stemDistance"</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                        <span class="op">*</span> np.sin(veg_map[<span class="st">"stemAzimuth"</span>]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">*</span> np.pi <span class="op">/</span> <span class="dv">180</span>))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>veg_map[<span class="st">"adjNorthing"</span>] <span class="op">=</span> (veg_map[<span class="st">"northing"</span>]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                        <span class="op">+</span> veg_map[<span class="st">"stemDistance"</span>]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                        <span class="op">*</span> np.cos(veg_map[<span class="st">"stemAzimuth"</span>]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">*</span> np.pi <span class="op">/</span> <span class="dv">180</span>))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>veg_map[<span class="st">"adjCoordinateUncertainty"</span>] <span class="op">=</span> veg_map[<span class="st">"coordinateUncertainty"</span>] <span class="op">+</span> <span class="fl">0.6</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>veg_map[<span class="st">"adjElevationUncertainty"</span>] <span class="op">=</span> veg_map[<span class="st">"elevationUncertainty"</span>] <span class="op">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Look at the columns to see all the information contained in this dataset.</p>
<div id="cell-17" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>veg_map.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>Index(['uid', 'namedLocation', 'date', 'eventID', 'domainID', 'siteID',
       'plotID', 'pointID', 'stemDistance', 'stemAzimuth', 'recordType',
       'individualID', 'supportingStemIndividualID', 'previouslyTaggedAs',
       'otherTagID', 'otherTagOrg', 'samplingProtocolVersion',
       'identificationHistoryID', 'taxonID', 'scientificName', 'genus',
       'family', 'taxonRank', 'identificationReferences', 'morphospeciesID',
       'morphospeciesIDRemarks', 'identificationQualifier', 'remarks',
       'measuredBy', 'recordedBy', 'dataQF', 'publicationDate', 'release',
       'points', 'easting', 'northing', 'coordinateUncertainty',
       'elevationUncertainty', 'adjEasting', 'adjNorthing',
       'adjCoordinateUncertainty', 'adjElevationUncertainty'],
      dtype='object')</code></pre>
</div>
</div>
<section id="combine-location-with-tree-traits" class="level3">
<h3 class="anchored" data-anchor-id="combine-location-with-tree-traits">Combine location with tree traits</h3>
<p>Now we have the mapped locations of individuals in the <code>vst_mappingandtagging</code> table, and the taxa (species, or <code>taxonID</code>), family, scientific name, as well as annual measurements of tree dimensions such as height and diameter in the <code>vst_apparentindividual</code> table. To bring these measurements together, join the two tables. Refer to the <a href="https://data.neonscience.org/api/v0/documents/quick-start-guides/NEON.QSG.DP1.00001.001v2?inline=TRUE" target="_blank">Quick Start Guide for Vegetation Structure</a> for more information about the data tables and the joining instructions.</p>
<div id="cell-19" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>veg_dict[<span class="st">"vst_apparentindividual"</span>].set_index(<span class="st">"individualID"</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>veg <span class="op">=</span> veg_map.join(veg_dict[<span class="st">"vst_apparentindividual"</span>],</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                   on<span class="op">=</span><span class="st">"individualID"</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                   how<span class="op">=</span><span class="st">"inner"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                   lsuffix<span class="op">=</span><span class="st">"_MAT"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                   rsuffix<span class="op">=</span><span class="st">"_AI"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-20" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show all the columns in the joined veg dataset</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>veg.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>Index(['uid_MAT', 'namedLocation_MAT', 'date_MAT', 'eventID_MAT',
       'domainID_MAT', 'siteID_MAT', 'plotID_MAT', 'pointID', 'stemDistance',
       'stemAzimuth', 'recordType', 'individualID',
       'supportingStemIndividualID', 'previouslyTaggedAs', 'otherTagID',
       'otherTagOrg', 'samplingProtocolVersion', 'identificationHistoryID',
       'taxonID', 'scientificName', 'genus', 'family', 'taxonRank',
       'identificationReferences', 'morphospeciesID', 'morphospeciesIDRemarks',
       'identificationQualifier', 'remarks_MAT', 'measuredBy_MAT',
       'recordedBy_MAT', 'dataQF_MAT', 'publicationDate_MAT', 'release_MAT',
       'points', 'easting', 'northing', 'coordinateUncertainty',
       'elevationUncertainty', 'adjEasting', 'adjNorthing',
       'adjCoordinateUncertainty', 'adjElevationUncertainty', 'uid_AI',
       'namedLocation_AI', 'date_AI', 'eventID_AI', 'domainID_AI', 'siteID_AI',
       'plotID_AI', 'subplotID', 'tempStemID', 'tagStatus', 'growthForm',
       'plantStatus', 'stemDiameter', 'measurementHeight',
       'changedMeasurementLocation', 'height', 'baseCrownHeight',
       'breakHeight', 'breakDiameter', 'maxCrownDiameter',
       'ninetyCrownDiameter', 'canopyPosition', 'shape', 'basalStemDiameter',
       'basalStemDiameterMsrmntHeight', 'maxBaseCrownDiameter',
       'ninetyBaseCrownDiameter', 'dendrometerInstallationDate',
       'initialGapMeasurementDate', 'initialBandStemDiameter',
       'initialDendrometerGap', 'dendrometerHeight', 'dendrometerGap',
       'dendrometerCondition', 'bandStemDiameter', 'remarks_AI',
       'recordedBy_AI', 'measuredBy_AI', 'dataEntryRecordID', 'dataQF_AI',
       'publicationDate_AI', 'release_AI'],
      dtype='object')</code></pre>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the dataframe for out a subset of the columns that may be relevant</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>veg[[<span class="st">'date_AI'</span>,<span class="st">'individualID'</span>,<span class="st">'scientificName'</span>,<span class="st">'taxonID'</span>,<span class="st">'family'</span>,<span class="st">'growthForm'</span>,<span class="st">'plantStatus'</span>,<span class="st">'plotID_AI'</span>,<span class="st">'pointID'</span>,<span class="st">'stemDiameter'</span>,<span class="st">'adjEasting'</span>,<span class="st">'adjNorthing'</span>]].head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date_AI</th>
<th data-quarto-table-cell-role="th">individualID</th>
<th data-quarto-table-cell-role="th">scientificName</th>
<th data-quarto-table-cell-role="th">taxonID</th>
<th data-quarto-table-cell-role="th">family</th>
<th data-quarto-table-cell-role="th">growthForm</th>
<th data-quarto-table-cell-role="th">plantStatus</th>
<th data-quarto-table-cell-role="th">plotID_AI</th>
<th data-quarto-table-cell-role="th">pointID</th>
<th data-quarto-table-cell-role="th">stemDiameter</th>
<th data-quarto-table-cell-role="th">adjEasting</th>
<th data-quarto-table-cell-role="th">adjNorthing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2015-09-28</td>
<td>NEON.PLA.D02.SERC.08038</td>
<td>Carya glabra (Mill.) Sweet</td>
<td>CAGL8</td>
<td>Juglandaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_045</td>
<td>43</td>
<td>46.4</td>
<td>364809.083993</td>
<td>4.304727e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-10-11</td>
<td>NEON.PLA.D02.SERC.08038</td>
<td>Carya glabra (Mill.) Sweet</td>
<td>CAGL8</td>
<td>Juglandaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_045</td>
<td>43</td>
<td>47.1</td>
<td>364809.083993</td>
<td>4.304727e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-11-16</td>
<td>NEON.PLA.D02.SERC.08038</td>
<td>Carya glabra (Mill.) Sweet</td>
<td>CAGL8</td>
<td>Juglandaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_045</td>
<td>43</td>
<td>47.4</td>
<td>364809.083993</td>
<td>4.304727e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2018-10-02</td>
<td>NEON.PLA.D02.SERC.08038</td>
<td>Carya glabra (Mill.) Sweet</td>
<td>CAGL8</td>
<td>Juglandaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_045</td>
<td>43</td>
<td>47.9</td>
<td>364809.083993</td>
<td>4.304727e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-11-07</td>
<td>NEON.PLA.D02.SERC.08038</td>
<td>Carya glabra (Mill.) Sweet</td>
<td>CAGL8</td>
<td>Juglandaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_045</td>
<td>43</td>
<td>47.9</td>
<td>364809.083993</td>
<td>4.304727e+06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="remove-duplicate-records" class="level2">
<h2 class="anchored" data-anchor-id="remove-duplicate-records">Remove duplicate records</h2>
<p>Some of these trees may have several recorded measurements, since we included all years of data. We will select only the latest recorded data so as to remove any duplicated data points. While measurements such as the tree height and stem diamter may change from one year to the next, the species should not.</p>
<div id="cell-23" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'date_AI' to datetime</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>veg.loc[:, <span class="st">'date_AI'</span>] <span class="op">=</span> pd.to_datetime(veg[<span class="st">'date_AI'</span>])</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the DataFrame by 'individualID' and 'date_AI' in descending order</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>veg_date_sorted <span class="op">=</span> veg.sort_values(by<span class="op">=</span>[<span class="st">'individualID'</span>, <span class="st">'date_AI'</span>], ascending<span class="op">=</span>[<span class="va">True</span>, <span class="va">False</span>])</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop duplicates, keeping the first occurrence (which is the latest, or most recent, due to sorting)</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>veg_latest <span class="op">=</span> veg_date_sorted.drop_duplicates(subset<span class="op">=</span><span class="st">'individualID'</span>, keep<span class="op">=</span><span class="st">'first'</span>).copy()</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the DataFrame with only the latest entries for each individualID</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(veg_latest))</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display a subset of the columns</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>veg_latest[[<span class="st">'date_AI'</span>,<span class="st">'individualID'</span>,<span class="st">'scientificName'</span>,<span class="st">'taxonID'</span>,<span class="st">'family'</span>,<span class="st">'growthForm'</span>,<span class="st">'plantStatus'</span>,<span class="st">'plotID_AI'</span>,<span class="st">'pointID'</span>,<span class="st">'stemDiameter'</span>,<span class="st">'adjEasting'</span>,<span class="st">'adjNorthing'</span>]].head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1185</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date_AI</th>
<th data-quarto-table-cell-role="th">individualID</th>
<th data-quarto-table-cell-role="th">scientificName</th>
<th data-quarto-table-cell-role="th">taxonID</th>
<th data-quarto-table-cell-role="th">family</th>
<th data-quarto-table-cell-role="th">growthForm</th>
<th data-quarto-table-cell-role="th">plantStatus</th>
<th data-quarto-table-cell-role="th">plotID_AI</th>
<th data-quarto-table-cell-role="th">pointID</th>
<th data-quarto-table-cell-role="th">stemDiameter</th>
<th data-quarto-table-cell-role="th">adjEasting</th>
<th data-quarto-table-cell-role="th">adjNorthing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">805</td>
<td>2022-12-05 00:00:00</td>
<td>NEON.PLA.D02.SERC.00017</td>
<td>Acer rubrum L.</td>
<td>ACRU</td>
<td>Aceraceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_054</td>
<td>39</td>
<td>27.5</td>
<td>365000.851457</td>
<td>4.305652e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">823</td>
<td>2022-12-05 00:00:00</td>
<td>NEON.PLA.D02.SERC.00029</td>
<td>Fagus grandifolia Ehrh.</td>
<td>FAGR</td>
<td>Fagaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_054</td>
<td>57</td>
<td>34.2</td>
<td>365008.826768</td>
<td>4.305655e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">819</td>
<td>2022-12-05 00:00:00</td>
<td>NEON.PLA.D02.SERC.00032</td>
<td>Fagus grandifolia Ehrh.</td>
<td>FAGR</td>
<td>Fagaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_054</td>
<td>39</td>
<td>32.0</td>
<td>365002.039970</td>
<td>4.305661e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3865</td>
<td>2022-12-05 00:00:00</td>
<td>NEON.PLA.D02.SERC.00039</td>
<td>Fagus grandifolia Ehrh.</td>
<td>FAGR</td>
<td>Fagaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_054</td>
<td>57</td>
<td>10.7</td>
<td>364993.798628</td>
<td>4.305656e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3136</td>
<td>2022-12-05 00:00:00</td>
<td>NEON.PLA.D02.SERC.00041</td>
<td>Liquidambar styraciflua L.</td>
<td>LIST2</td>
<td>Hamamelidaceae</td>
<td>small tree</td>
<td>Standing dead</td>
<td>SERC_054</td>
<td>57</td>
<td>9.7</td>
<td>364990.841914</td>
<td>4.305660e+06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now create a new dataframe containing only the veg data that are within a single AOP tile (which are 1 km x 1 km in size). For this, you will need to know the bounds (minimum and maximum UTM easting and northing) of the area you are sampling. For this exercise, we will choose the AOP data with SW (lower left) UTM coordinates of 364000, 4305000. This tile encompasses the NEON tower at the SERC site.</p>
<div id="cell-25" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>veg_tower_tile <span class="op">=</span> veg_latest[(veg_latest[<span class="st">'adjEasting'</span>].between(<span class="dv">364000</span>, <span class="dv">365000</span>)) <span class="op">&amp;</span> (veg_latest[<span class="st">'adjNorthing'</span>].between(<span class="dv">4305000</span>, <span class="dv">4306000</span>))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How many records do we have within this tile?</p>
<div id="cell-27" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(veg_tower_tile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>207</code></pre>
</div>
</div>
<p>There are 207 unique vegetation records in this area. We can also look at the unique <code>taxonID</code>s that are represented.</p>
<div id="cell-29" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the unique Taxon IDs</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>veg_tower_tile.taxonID.unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>array(['FAGR', 'LIST2', 'QUFA', 'LITU', 'ACRU', 'CACA18', 'NYSY', 'ULMUS',
       'CAGL8', 'QURU', 'QUAL', 'CATO6', 'PINUS', 'QUERC', 'COFL2',
       'PRAV', 'QUVE'], dtype=object)</code></pre>
</div>
</div>
<p>Let’s keep only a subset of the columns that we are interested in, and look at the dataframe:</p>
<div id="cell-31" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>veg_tower_tile_short <span class="op">=</span> veg_tower_tile[[<span class="st">'date_AI'</span>,<span class="st">'individualID'</span>,<span class="st">'scientificName'</span>,<span class="st">'taxonID'</span>,<span class="st">'family'</span>,<span class="st">'growthForm'</span>,<span class="st">'plantStatus'</span>,<span class="st">'plotID_AI'</span>,<span class="st">'pointID'</span>,<span class="st">'stemDiameter'</span>,<span class="st">'adjEasting'</span>,<span class="st">'adjNorthing'</span>]]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>veg_tower_tile_short</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date_AI</th>
<th data-quarto-table-cell-role="th">individualID</th>
<th data-quarto-table-cell-role="th">scientificName</th>
<th data-quarto-table-cell-role="th">taxonID</th>
<th data-quarto-table-cell-role="th">family</th>
<th data-quarto-table-cell-role="th">growthForm</th>
<th data-quarto-table-cell-role="th">plantStatus</th>
<th data-quarto-table-cell-role="th">plotID_AI</th>
<th data-quarto-table-cell-role="th">pointID</th>
<th data-quarto-table-cell-role="th">stemDiameter</th>
<th data-quarto-table-cell-role="th">adjEasting</th>
<th data-quarto-table-cell-role="th">adjNorthing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3865</td>
<td>2022-12-05 00:00:00</td>
<td>NEON.PLA.D02.SERC.00039</td>
<td>Fagus grandifolia Ehrh.</td>
<td>FAGR</td>
<td>Fagaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_054</td>
<td>57</td>
<td>10.7</td>
<td>364993.798628</td>
<td>4.305656e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3136</td>
<td>2022-12-05 00:00:00</td>
<td>NEON.PLA.D02.SERC.00041</td>
<td>Liquidambar styraciflua L.</td>
<td>LIST2</td>
<td>Hamamelidaceae</td>
<td>small tree</td>
<td>Standing dead</td>
<td>SERC_054</td>
<td>57</td>
<td>9.7</td>
<td>364990.841914</td>
<td>4.305660e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">800</td>
<td>2022-12-05 00:00:00</td>
<td>NEON.PLA.D02.SERC.00043</td>
<td>Quercus falcata Michx.</td>
<td>QUFA</td>
<td>Fagaceae</td>
<td>single bole tree</td>
<td>Dead, broken bole</td>
<td>SERC_054</td>
<td>57</td>
<td>37.1</td>
<td>364991.794414</td>
<td>4.305655e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">911</td>
<td>2022-12-05 00:00:00</td>
<td>NEON.PLA.D02.SERC.00062</td>
<td>Quercus falcata Michx.</td>
<td>QUFA</td>
<td>Fagaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_054</td>
<td>39</td>
<td>59.7</td>
<td>364990.424114</td>
<td>4.305650e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1762</td>
<td>2023-11-29 00:00:00</td>
<td>NEON.PLA.D02.SERC.00173</td>
<td>Fagus grandifolia Ehrh.</td>
<td>FAGR</td>
<td>Fagaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_047</td>
<td>21</td>
<td>22.5</td>
<td>364673.259742</td>
<td>4.305225e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3787</td>
<td>2023-11-29 00:00:00</td>
<td>NEON.PLA.D02.SERC.14231</td>
<td>Fagus grandifolia Ehrh.</td>
<td>FAGR</td>
<td>Fagaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_047</td>
<td>23</td>
<td>10.8</td>
<td>364679.533579</td>
<td>4.305222e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4103</td>
<td>2023-01-16 00:00:00</td>
<td>NEON.PLA.D02.SERC.14548</td>
<td>Fagus grandifolia Ehrh.</td>
<td>FAGR</td>
<td>Fagaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_057</td>
<td>41</td>
<td>11.1</td>
<td>364455.772024</td>
<td>4.305415e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4096</td>
<td>2023-01-16 00:00:00</td>
<td>NEON.PLA.D02.SERC.14563</td>
<td>Quercus alba L.</td>
<td>QUAL</td>
<td>Fagaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_057</td>
<td>43</td>
<td>10.1</td>
<td>364470.101669</td>
<td>4.305412e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3818</td>
<td>2022-11-15 00:00:00</td>
<td>NEON.PLA.D02.SERC.14709</td>
<td>Fagus grandifolia Ehrh.</td>
<td>FAGR</td>
<td>Fagaceae</td>
<td>single bole tree</td>
<td>Live</td>
<td>SERC_052</td>
<td>41</td>
<td>10.4</td>
<td>364577.886559</td>
<td>4.305883e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3828</td>
<td>2022-11-17 00:00:00</td>
<td>NEON.PLA.D02.SERC.14723</td>
<td>Fagus grandifolia Ehrh.</td>
<td>FAGR</td>
<td>Fagaceae</td>
<td>single bole tree</td>
<td>Live, physically damaged</td>
<td>SERC_067</td>
<td>59</td>
<td>10.1</td>
<td>364353.644854</td>
<td>4.305790e+06</td>
</tr>
</tbody>
</table>

<p>207 rows × 12 columns</p>
</div>
</div>
</div>
<p>To get a better sense of the data, we can also look at the # of each species, to see if some species have more representation than others.</p>
<div id="cell-33" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display the taxonID counts, sorted descending</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>veg_tower_tile_taxon_counts <span class="op">=</span> veg_tower_tile[[<span class="st">'individualID'</span>,<span class="st">'taxonID'</span>]].groupby([<span class="st">'taxonID'</span>]).count()</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>veg_tower_tile_taxon_counts.sort_values(by<span class="op">=</span><span class="st">'individualID'</span>,ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">individualID</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">taxonID</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FAGR</td>
<td>47</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">LITU</td>
<td>35</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">LIST2</td>
<td>29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ACRU</td>
<td>16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CAGL8</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CACA18</td>
<td>11</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">QUAL</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NYSY</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CATO6</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">QUFA</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ULMUS</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">QURU</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">COFL2</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PINUS</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">QUVE</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PRAV</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">QUERC</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-34" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display the family counts, sorted descending</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>veg_tower_tile_family_counts <span class="op">=</span> veg_tower_tile[[<span class="st">'individualID'</span>,<span class="st">'family'</span>]].groupby([<span class="st">'family'</span>]).count()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>veg_tower_tile_family_counts.sort_values(by<span class="op">=</span><span class="st">'individualID'</span>,ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">individualID</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">family</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Fagaceae</td>
<td>73</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Magnoliaceae</td>
<td>35</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Hamamelidaceae</td>
<td>29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Juglandaceae</td>
<td>22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aceraceae</td>
<td>16</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Cornaceae</td>
<td>13</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Betulaceae</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Ulmaceae</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Pinaceae</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Rosaceae</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>It looks like there are a number of species mapped in this tower plot. You can use the https://plants.usda.gov website to look up the species information. The top 5 most abundant mapped species are linked below.</p>
<ul>
<li><a href="https://plants.usda.gov/plant-profile/FAGR">FAGR</a>: American Beech (Fagus grandifolia Ehrh.)</li>
<li><a href="https://plants.usda.gov/plant-profile/LITU">LITU</a>: Tuliptree (Liriodendron tulipifera L.)</li>
<li><a href="https://plants.usda.gov/plant-profile/LIST2">LIST2</a>: Sweetgum (Liquidambar styraciflua L.)</li>
<li><a href="https://plants.usda.gov/plant-profile/ACRU">ACRU</a>: Red Maple (Acer rubrum L.)</li>
<li><a href="https://plants.usda.gov/plant-profile/CAGL8">CAGL8</a>: Sweet pignut hickory (Carya glabra (Mill.))</li>
</ul>
<p>When carrying out classification, the species that only have small representation (1-5 samples) may not be modeled accurately due to a lack of sufficient training data. The challenge of mapping rarer species due to insufficient training data is well known. In the next tutorial, we will remove these poorly represented samples before generating a model.</p>
</section>
<section id="write-training-dataframe-to-csv-file" class="level2">
<h2 class="anchored" data-anchor-id="write-training-dataframe-to-csv-file">Write training dataframe to csv file</h2>
<p>Nonetheless, we have a fairly decent training dataset to work with. We can save the dataframe to a csv file called <code>serc_training_data.csv</code> as follows:</p>
<div id="cell-36" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>veg_tower_tile_short.to_csv(<span class="vs">r'</span><span class="dv">.\d</span><span class="vs">ata</span><span class="dv">\s</span><span class="vs">erc_training_data</span><span class="dv">.</span><span class="vs">csv'</span>,index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-species-and-stem-diameter" class="level2">
<h2 class="anchored" data-anchor-id="plot-species-and-stem-diameter">Plot species and stem diameter</h2>
<p>Finally, we can make a quick plot using <code>seaborn</code> (imported as <code>sns</code>) to show the spatial distrubtion of the trees surveyed in this area, along with their species (<code>scientificName</code>). Most of this code helps improve the formatting and appearance of the figure; the first <code>sns.scatterplot</code> chunk is all you really need to do to plot the essentials.</p>
<div id="cell-38" class="cell" data-scrolled="true" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.scatterplot(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>veg_tower_tile_short,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'adjEasting'</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'adjNorthing'</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    size<span class="op">=</span><span class="st">'stemDiameter'</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">'scientificName'</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    sizes<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">20</span>),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.7</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">'equal'</span>, adjustable<span class="op">=</span><span class="st">'datalim'</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove scientific notation</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(mticker.FuncFormatter(<span class="kw">lambda</span> x, _: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:.0f}</span><span class="ss">'</span>))</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_major_formatter(mticker.FuncFormatter(<span class="kw">lambda</span> y, _: <span class="ss">f'</span><span class="sc">{</span>y<span class="sc">:.0f}</span><span class="ss">'</span>))</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>ax.legend_.remove()</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>handles, labels <span class="op">=</span> ax.get_legend_handles_labels()</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>n_species <span class="op">=</span> veg_tower_tile_short[<span class="st">'scientificName'</span>].nunique()</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Species legend</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>hue_handles <span class="op">=</span> handles[<span class="dv">1</span>:n_species<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>hue_labels <span class="op">=</span> labels[<span class="dv">1</span>:n_species<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>legend1 <span class="op">=</span> ax.legend(</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    hue_handles, hue_labels,</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Species"</span>,</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="fl">0.5</span>),</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    loc<span class="op">=</span><span class="st">'center left'</span>,</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    fontsize<span class="op">=</span><span class="st">'small'</span>,</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    title_fontsize<span class="op">=</span><span class="st">'small'</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>ax.add_artist(legend1)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Size legend (skip the first label, which is the old 'stemDiameter')</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>size_handles <span class="op">=</span> handles[n_species<span class="op">+</span><span class="dv">2</span>:]</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>size_labels <span class="op">=</span> labels[n_species<span class="op">+</span><span class="dv">2</span>:]</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>legend2 <span class="op">=</span> ax.legend(</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    size_handles, size_labels,</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Stem Diameter (cm)"</span>,</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>    bbox_to_anchor<span class="op">=</span>(<span class="fl">1.5</span>, <span class="fl">0.5</span>),</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>    loc<span class="op">=</span><span class="st">'center left'</span>,</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>    fontsize<span class="op">=</span><span class="st">'small'</span>,</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>    title_fontsize<span class="op">=</span><span class="st">'small'</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title and axis labels</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"SERC Tree Species and Stem Diameters"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Easting (m)"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Northing (m)"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_make-classification-training-df_files/figure-html/cell-21-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="recap" class="level2">
<h2 class="anchored" data-anchor-id="recap">Recap</h2>
<p>In this lesson we have curated a training data set containing information about the tree family and species as well as its geographic location in UTM x, y coordinates. We can now pair this dataset with remote sensing data and create a model to predict the tree’s family based off airborne spectral data. The next tutorial, <a href="https://www.neonscience.org/resources/learning-hub/tutorials/refl-classification-pyxarray" target="_blank">Tree Classification with NEON Airborne Imaging Spectrometer Data using Python xarray</a>, will show how to do this!</p>


</section>
</main></div>

 <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/NEONScience\.github\.io\/neon-nasa-hsi-workshop\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../background/nasa_neon_comparison.html" class="pagination-link" aria-label="Comparing NEON and NASA Airborne Campaigns">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Comparing NEON and NASA Airborne Campaigns</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../neon/02_neon-refl-classification.html" class="pagination-link" aria-label="2 NEON - Reflectance Visualization and Classification">
        <span class="nav-page-text">2 NEON - Reflectance Visualization and Classification</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
 <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>NASA and NEON Airborne Hyperspectral Workshop - ESA 2025</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>